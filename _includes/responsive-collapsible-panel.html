<template id="responsive_collapsible_panel_tpl">
    <style>
        @media screen and (max-width: 739px) {
            .collapsible-content {
                position: sticky;
                top: 0;
                width: 100%;
                overflow-x: hidden;
                min-width: 14rem;
                max-height: 100vh;
                transition-property: height;
                transition-duration: 0.3s;
                transition-delay: 0.1s;
                transition-timing-function: ease-out;
                height: 0;
                /* transform-origin: top; */
                /* transform: scaleY(0); */
            }
            .collapsible-content.expanded {
                height: 575px;
            }
            .collapsible-toggle {
                background: #D9E1E2;
                font-weight: 300;
                line-height: 1.3;
                font-size: 24px;
                display: flex;
                min-height: 60px;
                align-items: center;
                display: block;
            }
            .collapsible-toggle a {
                padding: 12.8px 10px 14.8px;
                display: flex;
                height: 100%;
                align-items: center;
                text-decoration: none;
            }
            .collapsible-toggle a svg {
                width: 24px;
                height: 24px;
                color: #0055A6;
                margin-left: 4px;
                margin-top: 2px;
            }
        }
        @media screen and (min-width: 740px) {
            .collapsible-toggle {
                display: none;
            }
        }
    </style>
    <div class="collapsible-toggle">
        <a href="#" class="toggle-button">
            <slot name="heading-slot">Collapsible Details</slot> <svg xmlns="http://www.w3.org/2000/svg" 
                width="24" 
                height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                stroke-width="1" 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                class="feather feather-grid"
            >
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect> 
            </svg>
        </a>
    </div>
    <div class="collapsible-content">
        <slot name="content-slot"></slot>
    </div>
</template>
<script type="module">

    function collapseSection(element) {
        // get the height of the element's inner content, regardless of its actual size
        var sectionHeight = element.scrollHeight;
        
        // temporarily disable all css transitions
        var elementTransition = element.style.transition;
        element.style.transition = '';
        
        // on the next frame (as soon as the previous style change has taken effect),
        // explicitly set the element's height to its current pixel height, so we 
        // aren't transitioning out of 'auto'
        requestAnimationFrame(function() {
            element.style.height = sectionHeight + 'px';
            element.style.transition = elementTransition;
            
            // on the next frame (as soon as the previous style change has taken effect),
            // have the element transition to height: 0
            requestAnimationFrame(function() {
                element.style.height = 0 + 'px';
            });
        });
        
        // mark the section as "currently collapsed"
        element.setAttribute('data-collapsed', 'true');
    }
    function expandSection(element) {
        // get the height of the element's inner content, regardless of its actual size
        var sectionHeight = element.scrollHeight;
        
        // have the element transition to the height of its inner content
        element.style.height = sectionHeight + 'px';

        // when the next css transition finishes (which should be the one we just triggered)
        element.addEventListener('transitionend', function(e) {
            // remove this event listener so it only gets triggered once
            element.removeEventListener('transitionend', arguments.callee);
            
            // remove "height" from the element's inline styles, so it can return to its initial value
            element.style.height = null;
        });
        
        // mark the section as "currently not collapsed"
        element.setAttribute('data-collapsed', 'false');
    }

    class ResponsiveCollapsiblePanelElement extends HTMLElement {
        connectedCallback() {
            this.attachShadow({mode: 'open'});
            this.shadowRoot.appendChild(document.getElementById('responsive_collapsible_panel_tpl').content.cloneNode(true));
            this.shadowRoot.querySelector('.toggle-button').addEventListener('click', (e) => {
                e.preventDefault();
                this.shadowRoot.querySelector('.collapsible-content').classList.toggle('expanded');
            });
        }
        disconnectedCallback() {
            this.shadowRoot.querySelector('.toggle-button').removeEventListener('click');
        }
    }
    customElements.define('responsive-collapsible-panel', ResponsiveCollapsiblePanelElement);
</script>